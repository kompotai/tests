# Kompot E2E Tests

E2E —Ç–µ—Å—Ç—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-—Å–∏—Å—Ç–µ–º—ã Kompot –Ω–∞ –±–∞–∑–µ Playwright.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–æ–≤

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π workspace –Ω–∞ Stage

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://kompot-stage.up.railway.app/account/register –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å:

1. **–ü—Ä–∏–¥—É–º–∞–π—Ç–µ Workspace ID** ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, `tester-ivan` (–ª–∞—Ç–∏–Ω–∏—Ü–∞, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
2. **Email** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: `{–≤–∞—à-workspace-id}-owner@kompot.ai`
   –ü—Ä–∏–º–µ—Ä: `tester-ivan-owner@kompot.ai`
3. **–ü–∞—Ä–æ–ª—å** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: `{–≤–∞—à-workspace-id}Owner123!`
   –ü—Ä–∏–º–µ—Ä: `tester-ivanOwner123!`

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –°–æ–±–ª—é–¥–∞–π—Ç–µ —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç! –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç credentials –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ Workspace ID.

### 2. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone git@github.com:kompotai/tests.git
cd tests
npm install
npx playwright install chromium
```

### 3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env

```bash
cp .env.example .env
```

–û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à Workspace ID:

```env
BASE_URL=https://kompot-stage.up.railway.app
WS_ID=tester-ivan
```

**–í—Å—ë!** Email –∏ –ø–∞—Ä–æ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `WS_ID`.

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã

```bash
npm test
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  üë§ TESTER MODE ‚Äî UI —Ç–µ—Å—Ç—ã
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  BASE_URL:     https://kompot-stage.up.railway.app
  WS_ID:        tester-ivan
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  Credentials (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ WS_ID):
    Email:      tester-ivan-owner@kompot.ai
    Password:   tester-ivanOwner123!
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
```

---

## –î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

### üë§ Tester Mode

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–æ–≤. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```env
BASE_URL=https://kompot-stage.up.railway.app
WS_ID=–≤–∞—à-workspace-id
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –¢–µ—Å—Ç—ã –≤—Ö–æ–¥—è—Ç –≤ –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π workspace
- –ü—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ Super Admin
- –ü—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è UI —Ç–µ—Å—Ç—ã (CO1-CO4)

### üîß CI Mode

–î–ª—è GitHub Actions –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

```env
BASE_URL=https://kompot-stage.up.railway.app
WS_ID=megatest
MONGODB_URI=mongodb://...
SUPER_ADMIN_EMAIL=...
SUPER_ADMIN_PASSWORD=...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ workspace –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ owner –∏ —Å–æ–∑–¥–∞–Ω–∏–µ workspace
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ (REG1-REG3)
- –í—Å–µ UI —Ç–µ—Å—Ç—ã

---

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è credentials

–í—Å–µ credentials –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏–∑ `WS_ID` –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º:

| –†–æ–ª—å | Email | –ü–∞—Ä–æ–ª—å |
|------|-------|--------|
| Owner | `{WS_ID}-owner@kompot.ai` | `{WS_ID}Owner123!` |
| Admin | `{WS_ID}-admin@kompot.ai` | `{WS_ID}Admin123!` |
| Manager | `{WS_ID}-manager@kompot.ai` | `{WS_ID}Manager123!` |

**–ü—Ä–∏–º–µ—Ä –¥–ª—è `WS_ID=tester-ivan`:**

| –†–æ–ª—å | Email | –ü–∞—Ä–æ–ª—å |
|------|-------|--------|
| Owner | `tester-ivan-owner@kompot.ai` | `tester-ivanOwner123!` |
| Admin | `tester-ivan-admin@kompot.ai` | `tester-ivanAdmin123!` |

---

## –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `npm test` | –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ |
| `npm run test:headed` | –¢–µ—Å—Ç—ã —Å –≤–∏–¥–∏–º—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º |
| `npm run test:ui` | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π UI —Ä–µ–∂–∏–º Playwright |
| `npm run test:debug` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ |
| `npm run report` | –û—Ç–∫—Ä—ã—Ç—å HTML –æ—Ç—á—ë—Ç |

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –¢–æ–ª—å–∫–æ company-owner —Ç–µ—Å—Ç—ã
npx playwright test tests/e2e/02-company-owner

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
npx playwright test -g "CO1"
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/e2e/
‚îú‚îÄ‚îÄ 01-super-admin/       # Super Admin —Ç–µ—Å—Ç—ã (–ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –≤ Tester Mode)
‚îÇ   ‚îî‚îÄ‚îÄ super-admin-login.spec.ts
‚îú‚îÄ‚îÄ 02-company-owner/     # Owner + Workspace —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ company-owner.spec.ts
‚îî‚îÄ‚îÄ 03-workspace-users/   # –¢–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π workspace
```

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
01-super-admin  ‚Üí  02-company-owner  ‚Üí  03-workspace-users
     ‚îÇ                    ‚îÇ
     ‚îÇ                    ‚îú‚îÄ REG1-REG3: DB –ø—Ä–æ–≤–µ—Ä–∫–∏ (CI only)
     ‚îÇ                    ‚îî‚îÄ CO1-CO4: UI —Ç–µ—Å—Ç—ã (–æ–±–∞ —Ä–µ–∂–∏–º–∞)
     ‚îÇ
     ‚îî‚îÄ SA1-SA2: Super Admin login (CI only)
```

---

## Troubleshooting

### –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç –Ω–∞ –ª–æ–≥–∏–Ω–µ

**–ü—Ä–∏—á–∏–Ω–∞:** Workspace –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ credentials –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ workspace —Å–æ–∑–¥–∞–Ω –Ω–∞ Stage
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:
   - Email: `{WS_ID}-owner@kompot.ai`
   - Password: `{WS_ID}Owner123!`

### –û—à–∏–±–∫–∞ "WS_ID –Ω–µ –∑–∞–¥–∞–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —Å–æ–∑–¥–∞–Ω –∏–ª–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω `.env` —Ñ–∞–π–ª.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env, —É–∫–∞–∂–∏—Ç–µ WS_ID
```

### –¢–µ—Å—Ç—ã CO3/CO4 –ø–∞–¥–∞—é—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–µ—Å—Ç CO3 –º–µ–Ω—è–µ—Ç –ø–∞—Ä–æ–ª—å workspace, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π.

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –ö–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —á–∏—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –í Tester Mode —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å workspace –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CI Mode.

---

## –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –ø–∞–ø–∫–µ `tests/e2e/`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ fixtures –∏–∑ `@fixtures/users`:

```typescript
import { test, expect } from '@playwright/test';
import { OWNER, WORKSPACE_ID, IS_CI_MODE } from '@fixtures/users';

test('My test', async ({ page }) => {
  // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
  test.skip(!IS_CI_MODE, 'Requires CI Mode');

  await page.goto('/account/login');
  await page.fill('[data-testid="login-input-wsid"]', WORKSPACE_ID);
  await page.fill('[data-testid="login-input-email"]', OWNER.email);
  // ...
});
```

### Auth State

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ auth state —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `.auth/`:
- `.auth/owner.json`
- `.auth/admin.json`

–î—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ:

```typescript
test.use({ storageState: '.auth/owner.json' });
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Playwright Documentation](https://playwright.dev)
- [Kompot Stage](https://kompot-stage.up.railway.app)
